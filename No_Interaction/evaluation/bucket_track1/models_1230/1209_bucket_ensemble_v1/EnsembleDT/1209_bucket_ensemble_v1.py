log_level = 'INFO'
stack_frame = 1
num_heads = 4
work_dir = './work_dirs/1209_bucket_ensemble_v1/EnsembleDT'
dt_state_dim = 22
resume_from = '/export/v-qcaii/darwin/ManiSkill-Learn-Yehao/work_dirs/ManiSkillModels3/bucket/model_300000.ckpt'
agent = dict(
    type='EnsembleDT',
    batch_size=128,
    l1_loss=1.0,
    l2_loss=10.0,
    policy_cfg=dict(
        type='EmsembleContinuousDTPolicy',
        policy_head_cfg=dict(
            type='DeterministicHead', noise_std=1e-05, ensemble_num=3),
        nn_cfg=dict(
            type='FastBucketPointFormer',
            stack_frame=1,
            num_objs='num_objs',
            pcd_pn_cfg=dict(
                type='FastPointFormerCoreV0',
                xyz_embed_dim=64,
                rgb_embed_dim=64,
                state_diff_embed_dim=64,
                state_other_embed_dim=64,
                conv_cfg=dict(
                    type='ConvMLP',
                    norm_cfg=None,
                    mlp_spec=['agent_shape', 256, 256],
                    bias='auto',
                    inactivated_output=True,
                    conv_init_cfg=dict(type='xavier_init', gain=1, bias=0)),
                mlp_cfg=dict(
                    type='LinearMLP',
                    norm_cfg=None,
                    mlp_spec=[256, 256, 256],
                    bias='auto',
                    inactivated_output=True,
                    linear_init_cfg=dict(type='xavier_init', gain=1, bias=0)),
                stack_frame=1),
            state_mlp_cfg=dict(
                type='LinearMLP',
                norm_cfg=None,
                mlp_spec=['agent_shape', 256, 256],
                bias='auto',
                inactivated_output=True,
                linear_init_cfg=dict(type='xavier_init', gain=1, bias=0)),
            transformer_cfg=dict(
                type='TransformerEncoder',
                block_cfg=dict(
                    attention_cfg=dict(
                        type='MultiHeadSelfAttention',
                        embed_dim=256,
                        num_heads=4,
                        latent_dim=32,
                        dropout=0.1),
                    mlp_cfg=dict(
                        type='LinearMLP',
                        norm_cfg=None,
                        mlp_spec=[256, 1024, 256],
                        bias='auto',
                        inactivated_output=True,
                        linear_init_cfg=dict(
                            type='xavier_init', gain=1, bias=0)),
                    dropout=0.1),
                pooling_cfg=dict(embed_dim=256, num_heads=4, latent_dim=32),
                mlp_cfg=None,
                num_blocks=6),
            final_mlp_cfg=dict(
                type='LinearMLP',
                norm_cfg=None,
                mlp_spec=[256, 256, 'action_shape'],
                bias='auto',
                inactivated_output=True,
                linear_init_cfg=dict(type='xavier_init', gain=1, bias=0))),
        ensemble_dt=False,
        dt_state_dim=22,
        dt_K=8,
        dt_max_ep_len=200,
        dt_embed_dim=32,
        dt_n_layer=4,
        dt_n_head=8,
        dt_attn_pdrop=0.01,
        disable_reward=True,
        pass_through=False,
        original_weight=0.0,
        shuffle_noise=0.0,
        optim_cfg=dict(
            type='AdamW',
            lr=0.0001,
            weight_decay=5e-06,
            paramwise_cfg=dict(
                custom_keys=dict(
                    {'backbone.': dict(lr_mult=0.1, decay_mult=0.0)}))),
        lr_scheduler_cfg=dict(type='StepLR', step_size=50000, gamma=0.8)))
eval_cfg = dict(
    type='EvaluationDT',
    num=300,
    num_procs=1,
    use_hidden_state=False,
    start_state=None,
    save_traj=False,
    save_video=False,
    use_log=False,
    env_cfg=dict(
        type='gym',
        unwrapped=False,
        stack_frame=1,
        obs_mode='pointcloud',
        reward_type='dense',
        env_name='MoveBucket-v0'))
train_mfrl_cfg = dict(
    on_policy=False,
    total_steps=900000,
    warm_steps=0,
    n_steps=0,
    n_updates=100,
    n_eval=900000,
    n_checkpoint=10000,
    init_replay_buffers='',
    init_replay_with_split=[
        './full_mani_skill_data/compressed_data/RefineMoveBucket/',
        '/export/v-qcaii/darwin/ManiSkill/mani_skill/assets/config_files/bucket_models.yml'
    ])
env_cfg = dict(
    type='gym',
    unwrapped=False,
    stack_frame=1,
    obs_mode='pointcloud',
    reward_type='dense',
    env_name='MoveBucket-v0')
replay_cfg = dict(
    type='ReplayMemoryDT',
    capacity=1000000,
    buffer_keys=['obs', 'actions', 'rewards', 'dones'],
    max_ep_len=200,
    scale=50.0,
    K=8,
    compressed=True,
    mode='delayed')
